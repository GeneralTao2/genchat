$(function(){function o(){$("form.login p.error, form.register p.error").remove(),$("form.login input, form.register input").removeClass("error")}var e=!0;$(".switch-button").on("click",function(o){o.preventDefault(),$("input").val(""),e?(e=!1,$(".register").show("slow"),$(".login").hide()):(e=!0,$(".login").show("slow"),$(".register").hide())}),$("form.login input, form.register input").on("focus",function(){o()}),$(".register-button").on("click",function(e){e.preventDefault(),o();var t={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-password-confirm").val()};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/api/auth/register"}).done(function(o){o.ok?$(".register h2").after('<p class="success">Регистрация прошла успешно</p>'):($(".register h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})}),$(".login-button").on("click",function(e){e.preventDefault(),$("p.success").remove(),$("input").removeClass("success"),o();var t={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/api/auth/login"}).done(function(o){o.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})})}),$(function(){function o(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}$(".post-form input, #post-body").on("focus",function(){o()}),$(".post").hover(function(){$(".edit-pencil",this).show()},function(){$(".edit-pencil",this).hide()}),$(".publish-button, .save-button").on("click",function(e){e.preventDefault(),o();var t="save-button"===$(this).attr("class").split(" ")[0],n={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:t,postId:$("#post-id").val()};console.log("data"),$.ajax({type:"POST",data:JSON.stringify(n),contentType:"application/json",url:"/post/add"}).done(function(o){console.log(o),o.ok?t?$(location).attr("href","/post/edit/"+o.post.id):$(location).attr("href","/posts/"+o.post.url):($(".post-form h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("#post-"+o).addClass("error")}))})}),$("#file").on("change",function(){var o=new FormData;o.append("postId",$("#post-id").val()),o.append("file",$("#file")[0].files[0]),$.ajax({type:"POST",url:"/upload/image",data:o,processData:!1,contentType:!1,success:function(o){console.log(o),$("#fileinfo").prepend('<div class="img-container"><img src="/uploads'+o.filePath+'" alt="" /></div>')},error:function(o){console.log(o)}})}),$(".img-container").on("click",function(){var o=$(this).attr("id"),e=$("#post-body"),t=e[0].selectionStart,n=e.val(),r="![alt text](image"+o+")";e.val(n.substring(0,t)+r+n.substring(t))})}),$(function(){function o(o,n){if(e&&e.remove(),t=null,e=$("form.comment").clone(!0,!0),o)e.find(".cancel").hide(),e.appendTo(".comment-list");else{var r=$(n).parent();t=r.attr("id"),$(n).after(e)}e.css({display:"flex"})}var e,t;o(!0),$(".acomment").hover(function(){$(this).addClass("hovered"),$(".comment",this).length>0?$(".reply",this).hide():$(".reply",this).show()},function(){$(this).removeClass("hovered"),$(".reply",this).hide()}),$(".reply").on("click",function(){o(!1,$($(this).parent()).parent()),$(this).hide()}),$("form.comment .cancel").on("click",function(t){t.preventDefault(),e.remove(),o(!0)}),$("form.comment .send").on("click",function(n){n.preventDefault();var r={post:$(".comments").attr("id"),body:e.find("textarea").val(),parent:t};$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/comment/add"}).done(function(t){if(console.log(t),t.ok){var n='<ul><li style="background-color:#ffffe0;"><div class="acomment"><div class="heads"><div class="head"><a href="/users/'+t.login+'">'+t.login+'</a><spam class="date">Только что</spam></div></div>'+t.body+"</div></li></ul>";$(e).after(n),o(!0)}else void 0===t.error&&$(e).prepend('<p class="error">Неизвестная ошибка!</p>'),$(e).prepend('<p class="error">'+t.error+"</p>")})})});